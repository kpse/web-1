<h2>用户统计</h2>
<div class="well schools-search-panel">
  <span>检索：</span>
  <input ng-model="searchText"/>
</div>
<button type="submit" class="btn btn-success col-xs-offset-1 col-xs-2" ng-disabled="loading || !export"
        ng-csv="export()" csv-header="exportHeader()" add-bom="U+FEFF"
        filename="{{csvName}}">导出{{currentMonth}}数据
</button>
<button type="submit" class="btn btn-danger col-xs-offset-1" ng-disabled="loading" ng-confirm-msg="此操作会重新计算统计数据，已存在的数据不会被覆盖。确定要继续吗?"
        ng-confirm-click="forceToReCalculate()">
  重新计算{{currentMonth}}统计数据
</button>
<div class="loading" ng-show="loading"></div>
<table class="table table-hover table-condensed schools-list">
  <thead>
  <tr class="row">
    <th class="col-xs-2">学校全称</th>
    <th class="col-xs-1">学生总数</th>
    <th class="col-xs-1">家长总数</th>
    <th class="col-xs-2">总用户数</th>
    <th class="col-xs-2">当月用户数</th>
    <th class="col-xs-2">当月激活率</th>
    <th class="col-xs-2">当月活跃度</th>
  </tr>
  </thead>
  <tbody>
  <tr class="row">
    <td class="col-xs-2">合计：</td>
    <td class="col-xs-1">{{allChildren.length}}</td>
    <td class="col-xs-1">{{allParents.length}}</td>
    <td class="col-xs-2">{{allLoggedEver}}</td>
    <td class="col-xs-2">{{allLoggedOnce}}</td>
    <td class="col-xs-2">N/A</td>
    <td class="col-xs-2">N/A</td>
  </tr>

  <tr ng-repeat="kg in kindergartens | filter: searchText | orderBy:['-monthly.logged_ever', '-monthlyRate', '-monthlyChildRate']" class="row" ng-class="{editable: detail}" ng-click="detail(kg)">
    <td class="col-xs-2"><a ng-href="/admin#/kindergarten/{{::kg.school_id}}/welcome" ng-click="$event.stopPropagation()">{{kg.full_name}}</a></td>
    <td class="col-xs-1">{{kg.children.length}}</td>
    <td class="col-xs-1">{{kg.parents.length}}</td>
    <td class="col-xs-2">{{kg.monthly.logged_ever}}</td>
    <td class="col-xs-2">{{kg.monthly.logged_once}}</td>
    <td class="col-xs-2">{{kg.monthlyRate}}</td>
    <td class="col-xs-2">{{kg.monthlyChildRate}}</td>
  </tr>
  </tbody>
</table>

